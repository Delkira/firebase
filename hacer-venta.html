<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hacer Venta</title>

    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container">
      <!-- Formulario para ventas -->
      <div class="container">
        <h2>Hacer Venta</h2>
        <form id="form-venta">
          <div class="mb-3">
            <label for="modelo-venta" class="form-label">Modelo</label>
            <select class="form-control" id="modelo-venta" required></select>
          </div>
          <div class="mb-3">
            <label for="usuario-venta" class="form-label">Usuario</label>
            <select class="form-control" id="usuario-venta" required></select>
          </div>
          <button type="button" class="btn btn-secondary" onclick="regresar()">
            Regresar
          </button>
          <button type="submit" class="btn btn-primary">Enviar</button>
        </form>
      </div>
    </div>

    <div class="container" style="margin-top: 20px;">
      <table id="tabla-venta" class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>Modelo</th>
            <th>Usuario</th>
            <th>Editar</th>
            <th>Eliminar</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <script type="module" src="/js/firebase.js"></script>
    <script type="module" src="/js/venta/add-venta.js"></script>
    <script type="module" src="/js/venta/poblar.js"></script>

    <script type="module">
      import { doc, db, updateDoc, deleteDoc } from "/js/firebase.js";

      async function eliminarVenta(id) {
        await deleteDoc(doc(db, "ventas", id));
      }

      // Hacer la función eliminarVenta globalmente accesible
      window.eliminarVenta = eliminarVenta;

      async function editarVenta(id) {
        const nuevoNombreModelo = prompt(
          "Por favor, introduce el nuevo nombre del modelo:"
        );
        const nuevoUsuarioVenta = prompt(
          "Por favor, introduce el nuevo usuario de la venta:"
        );
        if (nuevoNombreModelo && nuevoUsuarioVenta) {
          try {
            const refVenta = doc(db, "ventas", id);

            await updateDoc(refVenta, {
              modelo: nuevoNombreModelo,
              usuario: nuevoUsuarioVenta,
            });
            alert("¡Venta actualizada exitosamente!");
          } catch (error) {
            console.error("Error actualizando documento: ", error);
          }
        } else {
          console.log("No se introdujo un nuevo nombre de modelo o usuario");
          alert("No se hicieron cambios.");
        }
      }

      // Hacer la función editarVenta globalmente accesible
      window.editarVenta = editarVenta;
    </script>

    <script type="module">
      import { collection, getDocs, db } from "/js/firebase.js";

      async function cargarModelos() {
        const modelosSnapshot = await getDocs(collection(db, "modelos"));
        const selectModelo = document.getElementById("modelo-venta");
        modelosSnapshot.forEach((doc) => {
          const option = document.createElement("option");
          option.value = doc.id;
          option.text = doc.data().name;
          selectModelo.add(option);
        });
      }

      async function cargarUsuarios() {
        const usuariosSnapshot = await getDocs(collection(db, "usuarios"));
        const selectUsuario = document.getElementById("usuario-venta");
        usuariosSnapshot.forEach((doc) => {
          const option = document.createElement("option");
          option.value = doc.id;
          option.text = doc.data().name;
          selectUsuario.add(option);
        });
      }

      cargarModelos();
      cargarUsuarios();

      // ... Resto del código ...
    </script>

    <script>
      function regresar() {
        location.href = "/";
      }
    </script>
  </body>
</html>
